{"cells":[{"cell_type":"markdown","metadata":{"id":"crALrXyJ20IH"},"source":["#### For Google Colab users:"]},{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":20348,"status":"ok","timestamp":1686727151730,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"},"user_tz":-420},"id":"XGK6Hn9q2Dpp","outputId":"407a3de0-14ae-44ba-b523-4bc02d6536a3"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/gdrive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/gdrive', force_remount=True)"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"dsaw1jGCTQOr","executionInfo":{"status":"ok","timestamp":1686727163765,"user_tz":-420,"elapsed":12041,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}},"outputId":"c61af47b-037b-474c-da7f-a72468812976"},"outputs":[{"output_type":"stream","name":"stdout","text":["\n","7-Zip [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21\n","p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,4 CPUs AMD EPYC 7B12 (830F10),ASM,AES-NI)\n","\n","Scanning the drive for archives:\n","  0M Scan /content/gdrive/MyDrive/UIT P . c dữ liệu/source/datasets/\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                                                                            \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b1 file, 271088774 bytes (259 MiB)\n","\n","Extracting archive: /content/gdrive/MyDrive/UIT Projects/Khai thác dữ liệu/source/datasets/card_transaction.zip\n","--\n","Path = /content/gdrive/MyDrive/UIT Projects/Khai thác dữ liệu/source/datasets/card_transaction.zip\n","Type = zip\n","Physical Size = 271088774\n","\n","  0%\b\b\b\b    \b\b\b\b  2% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b  4% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b  6% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b  8% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 10% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 12% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 14% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 16% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 19% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 21% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 23% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 25% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 27% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 29% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 31% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 34% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 36% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 38% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 41% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 43% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 45% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 48% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 50% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 52% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 55% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 57% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 59% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 61% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 63% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 65% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 67% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 69% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 70% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 72% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 74% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 76% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 78% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 80% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 82% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 84% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 86% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 89% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 91% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 93% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 96% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b 98% - card_transaction.csv\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b                           \b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\b\bEverything is Ok\n","\n","Size:       2354626737\n","Compressed: 271088774\n"]}],"source":["!7z x \"/content/gdrive/MyDrive/UIT Projects/Khai thác dữ liệu/source/datasets/card_transaction.zip\" -o\"/content\""]},{"cell_type":"markdown","metadata":{"id":"13aJIQaaFYDI"},"source":["#### 1. Import libraries and datasets:"]},{"cell_type":"code","execution_count":3,"metadata":{"id":"pfAELcsdGZ8t","executionInfo":{"status":"ok","timestamp":1686727166456,"user_tz":-420,"elapsed":2697,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}}},"outputs":[],"source":["import pandas as pd\n","import numpy as np\n","import matplotlib.pyplot as plt\n","import seaborn as sns\n","\n","import time\n","import random\n","import seaborn as sns\n","import matplotlib.pyplot as plt\n","from sklearn.preprocessing import StandardScaler, RobustScaler\n","from sklearn.model_selection import train_test_split, StratifiedShuffleSplit, cross_val_score, GridSearchCV\n","from sklearn.ensemble import RandomForestClassifier\n","\n","import collections\n","from collections import Counter\n","from imblearn.pipeline import make_pipeline as imbalanced_make_pipeline\n","from imblearn.over_sampling import SMOTE\n","from imblearn.under_sampling import NearMiss\n","from imblearn.metrics import classification_report_imbalanced\n","from sklearn.pipeline import make_pipeline\n","from sklearn.model_selection import KFold, StratifiedKFold\n","from sklearn.metrics import precision_score, recall_score, f1_score, roc_auc_score, accuracy_score, classification_report"]},{"cell_type":"code","execution_count":4,"metadata":{"id":"rxKJnGXoFdTo","executionInfo":{"status":"ok","timestamp":1686727166457,"user_tz":-420,"elapsed":10,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}}},"outputs":[],"source":["card_transaction_csv = \"/content/card_transaction.csv\""]},{"cell_type":"markdown","metadata":{"id":"VF8dnEAIKzts"},"source":["- Load Card transaction data (DATASET 2):"]},{"cell_type":"code","execution_count":5,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"elapsed":46027,"status":"ok","timestamp":1686727244690,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"},"user_tz":-420},"id":"9_Xwto4iHXfz","outputId":"0c6015dc-eb87-40aa-a7b9-5ce090e4425a"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   User  Card  Year  Month  Day   Time   Amount           Use Chip  \\\n","0     0     0  2002      9    1  06:21  $134.09  Swipe Transaction   \n","1     0     0  2002      9    1  06:42   $38.48  Swipe Transaction   \n","2     0     0  2002      9    2  06:22  $120.34  Swipe Transaction   \n","3     0     0  2002      9    2  17:45  $128.95  Swipe Transaction   \n","4     0     0  2002      9    3  06:23  $104.71  Swipe Transaction   \n","\n","         Merchant Name  Merchant City Merchant State      Zip   MCC Errors?  \\\n","0  3527213246127876953       La Verne             CA  91750.0  5300     NaN   \n","1  -727612092139916043  Monterey Park             CA  91754.0  5411     NaN   \n","2  -727612092139916043  Monterey Park             CA  91754.0  5411     NaN   \n","3  3414527459579106770  Monterey Park             CA  91754.0  5651     NaN   \n","4  5817218446178736267       La Verne             CA  91750.0  5912     NaN   \n","\n","  Is Fraud?  \n","0        No  \n","1        No  \n","2        No  \n","3        No  \n","4        No  "],"text/html":["\n","  <div id=\"df-af1ba647-fe3b-4b5d-980c-cc1d19ec503b\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>User</th>\n","      <th>Card</th>\n","      <th>Year</th>\n","      <th>Month</th>\n","      <th>Day</th>\n","      <th>Time</th>\n","      <th>Amount</th>\n","      <th>Use Chip</th>\n","      <th>Merchant Name</th>\n","      <th>Merchant City</th>\n","      <th>Merchant State</th>\n","      <th>Zip</th>\n","      <th>MCC</th>\n","      <th>Errors?</th>\n","      <th>Is Fraud?</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>1</td>\n","      <td>06:21</td>\n","      <td>$134.09</td>\n","      <td>Swipe Transaction</td>\n","      <td>3527213246127876953</td>\n","      <td>La Verne</td>\n","      <td>CA</td>\n","      <td>91750.0</td>\n","      <td>5300</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>1</td>\n","      <td>06:42</td>\n","      <td>$38.48</td>\n","      <td>Swipe Transaction</td>\n","      <td>-727612092139916043</td>\n","      <td>Monterey Park</td>\n","      <td>CA</td>\n","      <td>91754.0</td>\n","      <td>5411</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>2</td>\n","      <td>06:22</td>\n","      <td>$120.34</td>\n","      <td>Swipe Transaction</td>\n","      <td>-727612092139916043</td>\n","      <td>Monterey Park</td>\n","      <td>CA</td>\n","      <td>91754.0</td>\n","      <td>5411</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>2</td>\n","      <td>17:45</td>\n","      <td>$128.95</td>\n","      <td>Swipe Transaction</td>\n","      <td>3414527459579106770</td>\n","      <td>Monterey Park</td>\n","      <td>CA</td>\n","      <td>91754.0</td>\n","      <td>5651</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>3</td>\n","      <td>06:23</td>\n","      <td>$104.71</td>\n","      <td>Swipe Transaction</td>\n","      <td>5817218446178736267</td>\n","      <td>La Verne</td>\n","      <td>CA</td>\n","      <td>91750.0</td>\n","      <td>5912</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-af1ba647-fe3b-4b5d-980c-cc1d19ec503b')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-af1ba647-fe3b-4b5d-980c-cc1d19ec503b button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-af1ba647-fe3b-4b5d-980c-cc1d19ec503b');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":5}],"source":["df_cardtransaction = pd.read_csv(card_transaction_csv)\n","df_cardtransaction.head(5)"]},{"cell_type":"code","source":["df_cardtransaction[df_cardtransaction['Is Fraud?'] != 'No']"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"id":"cuk2gTgVxo-y","executionInfo":{"status":"ok","timestamp":1686727258371,"user_tz":-420,"elapsed":1616,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}},"outputId":"80d00b16-d3ac-4078-da30-c8d406697839"},"execution_count":6,"outputs":[{"output_type":"execute_result","data":{"text/plain":["          User  Card  Year  Month  Day   Time   Amount            Use Chip  \\\n","4099         0     0  2015     11   15  12:55  $287.13  Online Transaction   \n","4100         0     0  2015     11   15  13:19    $2.41  Online Transaction   \n","4101         0     0  2015     11   16  09:41   $50.81  Online Transaction   \n","4102         0     0  2015     11   16  09:46  $248.36  Online Transaction   \n","4103         0     0  2015     11   16  11:20  $473.00  Online Transaction   \n","...        ...   ...   ...    ...  ...    ...      ...                 ...   \n","24375668  1997     2  2016      9    4  10:45    $1.25  Online Transaction   \n","24375670  1997     2  2016      9    4  12:30  $116.66  Online Transaction   \n","24375671  1997     2  2016      9    4  12:40  $359.99  Online Transaction   \n","24375672  1997     2  2016      9    4  13:45  $351.51  Online Transaction   \n","24375673  1997     2  2016      9    4  13:55  $188.26  Online Transaction   \n","\n","                Merchant Name Merchant City Merchant State  Zip   MCC Errors?  \\\n","4099     -8194607650924472520        ONLINE            NaN  NaN  3001     NaN   \n","4100     -7759074308363763111        ONLINE            NaN  NaN  5651     NaN   \n","4101      -551332107213382088        ONLINE            NaN  NaN  4411     NaN   \n","4102      4872340518840476610        ONLINE            NaN  NaN  5732     NaN   \n","4103     -8566951830324093739        ONLINE            NaN  NaN  3640     NaN   \n","...                       ...           ...            ...  ...   ...     ...   \n","24375668  6455213054093379528        ONLINE            NaN  NaN  5815     NaN   \n","24375670   822647939787511611        ONLINE            NaN  NaN  5311     NaN   \n","24375671  8080934608468946743        ONLINE            NaN  NaN  5310     NaN   \n","24375672 -4282466774399734331        ONLINE            NaN  NaN  4829     NaN   \n","24375673  3189517333335617109        ONLINE            NaN  NaN  5311     NaN   \n","\n","         Is Fraud?  \n","4099           Yes  \n","4100           Yes  \n","4101           Yes  \n","4102           Yes  \n","4103           Yes  \n","...            ...  \n","24375668       Yes  \n","24375670       Yes  \n","24375671       Yes  \n","24375672       Yes  \n","24375673       Yes  \n","\n","[29757 rows x 15 columns]"],"text/html":["\n","  <div id=\"df-0022e79f-fd92-4cd5-a04e-c40e6f03d43b\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>User</th>\n","      <th>Card</th>\n","      <th>Year</th>\n","      <th>Month</th>\n","      <th>Day</th>\n","      <th>Time</th>\n","      <th>Amount</th>\n","      <th>Use Chip</th>\n","      <th>Merchant Name</th>\n","      <th>Merchant City</th>\n","      <th>Merchant State</th>\n","      <th>Zip</th>\n","      <th>MCC</th>\n","      <th>Errors?</th>\n","      <th>Is Fraud?</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>4099</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2015</td>\n","      <td>11</td>\n","      <td>15</td>\n","      <td>12:55</td>\n","      <td>$287.13</td>\n","      <td>Online Transaction</td>\n","      <td>-8194607650924472520</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>3001</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>4100</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2015</td>\n","      <td>11</td>\n","      <td>15</td>\n","      <td>13:19</td>\n","      <td>$2.41</td>\n","      <td>Online Transaction</td>\n","      <td>-7759074308363763111</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>5651</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>4101</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2015</td>\n","      <td>11</td>\n","      <td>16</td>\n","      <td>09:41</td>\n","      <td>$50.81</td>\n","      <td>Online Transaction</td>\n","      <td>-551332107213382088</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>4411</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>4102</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2015</td>\n","      <td>11</td>\n","      <td>16</td>\n","      <td>09:46</td>\n","      <td>$248.36</td>\n","      <td>Online Transaction</td>\n","      <td>4872340518840476610</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>5732</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>4103</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2015</td>\n","      <td>11</td>\n","      <td>16</td>\n","      <td>11:20</td>\n","      <td>$473.00</td>\n","      <td>Online Transaction</td>\n","      <td>-8566951830324093739</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>3640</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>24375668</th>\n","      <td>1997</td>\n","      <td>2</td>\n","      <td>2016</td>\n","      <td>9</td>\n","      <td>4</td>\n","      <td>10:45</td>\n","      <td>$1.25</td>\n","      <td>Online Transaction</td>\n","      <td>6455213054093379528</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>5815</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>24375670</th>\n","      <td>1997</td>\n","      <td>2</td>\n","      <td>2016</td>\n","      <td>9</td>\n","      <td>4</td>\n","      <td>12:30</td>\n","      <td>$116.66</td>\n","      <td>Online Transaction</td>\n","      <td>822647939787511611</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>5311</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>24375671</th>\n","      <td>1997</td>\n","      <td>2</td>\n","      <td>2016</td>\n","      <td>9</td>\n","      <td>4</td>\n","      <td>12:40</td>\n","      <td>$359.99</td>\n","      <td>Online Transaction</td>\n","      <td>8080934608468946743</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>5310</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>24375672</th>\n","      <td>1997</td>\n","      <td>2</td>\n","      <td>2016</td>\n","      <td>9</td>\n","      <td>4</td>\n","      <td>13:45</td>\n","      <td>$351.51</td>\n","      <td>Online Transaction</td>\n","      <td>-4282466774399734331</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>4829</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","    <tr>\n","      <th>24375673</th>\n","      <td>1997</td>\n","      <td>2</td>\n","      <td>2016</td>\n","      <td>9</td>\n","      <td>4</td>\n","      <td>13:55</td>\n","      <td>$188.26</td>\n","      <td>Online Transaction</td>\n","      <td>3189517333335617109</td>\n","      <td>ONLINE</td>\n","      <td>NaN</td>\n","      <td>NaN</td>\n","      <td>5311</td>\n","      <td>NaN</td>\n","      <td>Yes</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>29757 rows × 15 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-0022e79f-fd92-4cd5-a04e-c40e6f03d43b')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-0022e79f-fd92-4cd5-a04e-c40e6f03d43b button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-0022e79f-fd92-4cd5-a04e-c40e6f03d43b');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":6}]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":11,"status":"ok","timestamp":1686720254698,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"},"user_tz":-420},"id":"dWJW2LX7Iaca","outputId":"89d798de-2b25-424a-e79a-39811304e96b"},"outputs":[{"output_type":"stream","name":"stdout","text":["15\n","['User', 'Card', 'Year', 'Month', 'Day', 'Time', 'Amount', 'Use Chip', 'Merchant Name', 'Merchant City', 'Merchant State', 'Zip', 'MCC', 'Errors?', 'Is Fraud?']\n"]}],"source":["columns = df_cardtransaction.keys()\n","print(len(columns))\n","print(list(columns))"]},{"cell_type":"markdown","metadata":{"id":"L3R0EdGkZFgQ"},"source":["#### Preprocessing data:"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":9,"status":"ok","timestamp":1686720254698,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"},"user_tz":-420},"id":"FW9hG9ApKgiV","outputId":"a8e2a49e-9d83-4460-9e58-af0369c2e556"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["Index(['User', 'Card', 'Year', 'Month', 'Day', 'Time', 'Amount', 'Use Chip',\n","       'Merchant Name', 'Merchant City', 'Merchant State', 'Zip', 'MCC',\n","       'Errors?', 'Is Fraud?'],\n","      dtype='object')"]},"metadata":{},"execution_count":7}],"source":["df = df_cardtransaction\n","df.keys()"]},{"cell_type":"code","source":["df[\"Time\"] = pd.to_datetime(df[\"Time\"], infer_datetime_format=True)"],"metadata":{"id":"YoiZbvISXP-9"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df[df.columns[6]] = df[df.columns[6]].replace('[\\$,]', '', regex=True).astype(float)"],"metadata":{"id":"tFgCRTPUZDwk"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["df.head(5)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":461},"id":"WiU5A4iKaFT9","executionInfo":{"status":"ok","timestamp":1686722391492,"user_tz":-420,"elapsed":438,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}},"outputId":"56eab1e4-ffaf-4b59-cf3f-aec5a0c1210f"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["   User  Card  Year  Month  Day                Time  Amount  \\\n","0     0     0  2002      9    1 2023-06-14 06:21:00  134.09   \n","1     0     0  2002      9    1 2023-06-14 06:42:00   38.48   \n","2     0     0  2002      9    2 2023-06-14 06:22:00  120.34   \n","3     0     0  2002      9    2 2023-06-14 17:45:00  128.95   \n","4     0     0  2002      9    3 2023-06-14 06:23:00  104.71   \n","\n","            Use Chip        Merchant Name  Merchant City Merchant State  \\\n","0  Swipe Transaction  3527213246127876953       La Verne             CA   \n","1  Swipe Transaction  -727612092139916043  Monterey Park             CA   \n","2  Swipe Transaction  -727612092139916043  Monterey Park             CA   \n","3  Swipe Transaction  3414527459579106770  Monterey Park             CA   \n","4  Swipe Transaction  5817218446178736267       La Verne             CA   \n","\n","       Zip   MCC Errors? Is Fraud?  hour_of_day  \n","0  91750.0  5300     NaN        No            6  \n","1  91754.0  5411     NaN        No            6  \n","2  91754.0  5411     NaN        No            6  \n","3  91754.0  5651     NaN        No           17  \n","4  91750.0  5912     NaN        No            6  "],"text/html":["\n","  <div id=\"df-f3fe9717-67e8-436a-ac79-aa770c1b50a0\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>User</th>\n","      <th>Card</th>\n","      <th>Year</th>\n","      <th>Month</th>\n","      <th>Day</th>\n","      <th>Time</th>\n","      <th>Amount</th>\n","      <th>Use Chip</th>\n","      <th>Merchant Name</th>\n","      <th>Merchant City</th>\n","      <th>Merchant State</th>\n","      <th>Zip</th>\n","      <th>MCC</th>\n","      <th>Errors?</th>\n","      <th>Is Fraud?</th>\n","      <th>hour_of_day</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>1</td>\n","      <td>2023-06-14 06:21:00</td>\n","      <td>134.09</td>\n","      <td>Swipe Transaction</td>\n","      <td>3527213246127876953</td>\n","      <td>La Verne</td>\n","      <td>CA</td>\n","      <td>91750.0</td>\n","      <td>5300</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","      <td>6</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>1</td>\n","      <td>2023-06-14 06:42:00</td>\n","      <td>38.48</td>\n","      <td>Swipe Transaction</td>\n","      <td>-727612092139916043</td>\n","      <td>Monterey Park</td>\n","      <td>CA</td>\n","      <td>91754.0</td>\n","      <td>5411</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","      <td>6</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>2</td>\n","      <td>2023-06-14 06:22:00</td>\n","      <td>120.34</td>\n","      <td>Swipe Transaction</td>\n","      <td>-727612092139916043</td>\n","      <td>Monterey Park</td>\n","      <td>CA</td>\n","      <td>91754.0</td>\n","      <td>5411</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","      <td>6</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>2</td>\n","      <td>2023-06-14 17:45:00</td>\n","      <td>128.95</td>\n","      <td>Swipe Transaction</td>\n","      <td>3414527459579106770</td>\n","      <td>Monterey Park</td>\n","      <td>CA</td>\n","      <td>91754.0</td>\n","      <td>5651</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","      <td>17</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>2002</td>\n","      <td>9</td>\n","      <td>3</td>\n","      <td>2023-06-14 06:23:00</td>\n","      <td>104.71</td>\n","      <td>Swipe Transaction</td>\n","      <td>5817218446178736267</td>\n","      <td>La Verne</td>\n","      <td>CA</td>\n","      <td>91750.0</td>\n","      <td>5912</td>\n","      <td>NaN</td>\n","      <td>No</td>\n","      <td>6</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f3fe9717-67e8-436a-ac79-aa770c1b50a0')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-f3fe9717-67e8-436a-ac79-aa770c1b50a0 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-f3fe9717-67e8-436a-ac79-aa770c1b50a0');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":38}]},{"cell_type":"code","source":["df['hour_of_day'] = df.Time.dt.hour"],"metadata":{"id":"-ocMfgUBcQv-"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["features = ['hour_of_day', 'Card', 'Amount', 'Merchant Name', 'Merchant City']\n","\n","X = df[features]\n","y = df['Is Fraud?']\n","\n","print('X shape:{}\\ny shape:{}'.format(X.shape,y.shape))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"qNBAZAAFaXfO","executionInfo":{"status":"ok","timestamp":1686721639542,"user_tz":-420,"elapsed":1048,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}},"outputId":"0ce497b3-d9c4-4ee2-e2bf-9fcaa2558615"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["X shape:(24386900, 5)\n","y shape:(24386900,)\n"]}]},{"cell_type":"code","source":["from sklearn.preprocessing import OrdinalEncoder\n","\n","enc = OrdinalEncoder(dtype=np.int64)\n","enc.fit(X.loc[:,['Merchant City']])\n","\n","X.loc[:, ['Merchant City']] = enc.transform(X[['Merchant City']])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"l5y96TzhZ6rx","executionInfo":{"status":"ok","timestamp":1686721650791,"user_tz":-420,"elapsed":9605,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}},"outputId":"b9f913e7-671d-4075-b212-fc7581a1df87"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stderr","text":["<ipython-input-27-96fa1136f296>:6: SettingWithCopyWarning: \n","A value is trying to be set on a copy of a slice from a DataFrame.\n","Try using .loc[row_indexer,col_indexer] = value instead\n","\n","See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n","  X.loc[:, ['Merchant City']] = enc.transform(X[['Merchant City']])\n","<ipython-input-27-96fa1136f296>:6: DeprecationWarning: In a future version, `df.iloc[:, i] = newvals` will attempt to set the values inplace instead of always setting a new array. To retain the old behavior, use either `df[df.columns[i]] = newvals` or, if columns are non-unique, `df.isetitem(i, newvals)`\n","  X.loc[:, ['Merchant City']] = enc.transform(X[['Merchant City']])\n"]}]},{"cell_type":"code","source":["X.loc[:, ['Merchant City']]"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":423},"id":"MXUZYIwmfp1y","executionInfo":{"status":"ok","timestamp":1686722491733,"user_tz":-420,"elapsed":18,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}},"outputId":"c2ca3225-e61d-431d-f811-fd4d6ddfaf27"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["          Merchant City\n","0                  6275\n","1                  7828\n","2                  7828\n","3                  7828\n","4                  6275\n","...                 ...\n","24386895           7556\n","24386896           7556\n","24386897           7556\n","24386898           7556\n","24386899           7556\n","\n","[24386900 rows x 1 columns]"],"text/html":["\n","  <div id=\"df-9fb9de5d-343a-4102-9761-fd252ef9c997\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Merchant City</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>6275</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>7828</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>7828</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>7828</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>6275</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>24386895</th>\n","      <td>7556</td>\n","    </tr>\n","    <tr>\n","      <th>24386896</th>\n","      <td>7556</td>\n","    </tr>\n","    <tr>\n","      <th>24386897</th>\n","      <td>7556</td>\n","    </tr>\n","    <tr>\n","      <th>24386898</th>\n","      <td>7556</td>\n","    </tr>\n","    <tr>\n","      <th>24386899</th>\n","      <td>7556</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>24386900 rows × 1 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-9fb9de5d-343a-4102-9761-fd252ef9c997')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-9fb9de5d-343a-4102-9761-fd252ef9c997 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-9fb9de5d-343a-4102-9761-fd252ef9c997');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":39}]},{"cell_type":"code","source":["from sklearn.feature_selection import SelectKBest\n","from sklearn.feature_selection import chi2\n","\n","def select_features(X_train, y_train, X_test):\n","    fs = SelectKBest(score_func=chi2, k='all')\n","    fs.fit(X_train, y_train)\n","    X_train_fs = fs.transform(X_train)\n","    X_test_fs = fs.transform(X_test)\n","    return X_train_fs, X_test_fs, fs"],"metadata":{"id":"2rmjaSjKbjrj"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, stratify=y)\n","print('X_train shape:{}\\ny_train shape:{}'.format(X_train.shape,y_train.shape))\n","print('X_test shape:{}\\ny_test shape:{}'.format(X_test.shape,y_test.shape))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5IxYgqmLbk8g","executionInfo":{"status":"ok","timestamp":1686721693366,"user_tz":-420,"elapsed":25755,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}},"outputId":"e4c5cc59-f86c-4d42-f5db-6920bdd4bdd5"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["X_train shape:(19509520, 5)\n","y_train shape:(19509520,)\n","X_test shape:(4877380, 5)\n","y_test shape:(4877380,)\n"]}]},{"cell_type":"code","source":["from imblearn.over_sampling import SMOTE\n","smote = SMOTE(sampling_strategy='minority', random_state=42)\n","\n","X_train_smote, y_train_smote = smote.fit_resample(X_train.astype('float'), y_train)\n","print(\"Before SMOTE:\", Counter(y_train))\n","print(\"After SMOTE:\", Counter(y_train_smote))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"TrGV2nYCb7eJ","executionInfo":{"status":"ok","timestamp":1686721881283,"user_tz":-420,"elapsed":70545,"user":{"displayName":"Nam Đỗ Đặng Kiến","userId":"08452134426123711871"}},"outputId":"598ee0c6-dfb8-4d89-9fef-f0ab69a73646"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Before SMOTE: Counter({'No': 19485714, 'Yes': 23806})\n","After SMOTE: Counter({'No': 19485714, 'Yes': 19485714})\n"]}]},{"cell_type":"code","source":["rf = RandomForestClassifier(criterion= 'entropy', max_depth=6, max_features='log2', n_estimators=3, n_jobs=10)\n","rf.fit(X_train, y_train)\n","\n","y_pred_rf = rf.predict(X_test)"],"metadata":{"id":"4VcQR9_kbn19"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"jEC5sFEv2y5w"},"outputs":[],"source":["import pickle\n","\n","with open('model.pkl','wb') as f:\n","    pickle.dump(rf,f)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"PX3AfQ5k3jeK"},"outputs":[],"source":["import pickle\n","\n","with open('model.pkl', 'rb') as f:\n","    clf2 = pickle.load(f)"]}],"metadata":{"colab":{"collapsed_sections":["crALrXyJ20IH"],"machine_shape":"hm","provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}